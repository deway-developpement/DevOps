# Check for the '-os' argument passed to Vagrant
param = ARGV.find { |arg| arg.start_with?('-os=') }
os_type = param ? param.split('=').last : 'default'

Vagrant.configure("2") do |config|

  case os_type
  when 'windows'
    config.vm.box = "base"  # Use a "base" box for Windows

    # Set VM properties for Windows
    config.vm.provider "virtualbox" do |vb|
      vb.memory = "1024"
    end
  else
    config.vm.box = "utm/debian11"  # Use a Debian box for Mac

    # Set VM properties for UTM
    config.vm.provider "utm" do |u|
      u.name = "debian_vm"
      u.memory = "4096"   # 4GB memory
      u.cpus = 4          # 4 CPUs
      u.directory_share_mode = "virtFS"
    end
  end

  # Provisioning all requirements using a shell script
  config.vm.provision "shell", path: "provision.sh"

  # Forward port 80 from the VM to the host for bitwarden
  config.vm.network "forwarded_port", guest: 80, host: 80
end